<form class="form-horizontal" role="form">
    <div class="col-md-12 col-sm-12 widget-container-col ui-sortable">
        <div class="widget-box ui-sortable-handle">
            <div class="widget-header">
                <h5 class="widget-title"> Exploit Target: {{exploit_target.stix_id}} </h5>
            </div>
            <div class="widget-body" ng-show="!part_two && !part_three">
                <div class="widget-main">

                    <div class="space-12"></div>

                    <acs-associate-form sets="sets" object=exploit_target objecttype="ExploitTarget" disable-save=is_saving editform=editform></acs-associate-form>

                    <div class="space-12"></div>

                    <div class="clearfix form-actions">
                        <span ng-show="is_saving"> <i class="ace-icon fa fa-sun-o fa-spin blue bigger-300 pull-right" ng-show="is_saving"></i> </span>
                        <button ng-disabled="is_saving" class="btn btn-info pull-right ciap_mleft_12" type="button" ng-click="to_vulnerability(exploit_target)">
                            <i class="fa fa-arrow-right"></i>
                            Next
                        </button>
                        <button class="btn btn-default pull-right" type="button" ng-click="cancel()" ng-disabled="is_saving">
                            <i class="ace-icon fa fa-times bigger-110"></i> Cancel
                        </button>
                    </div>
                </div>
            </div>

            <div class="widget-body" ng-show="!part_one && !part_three">
                <div class="widget-main">

                    <div ng-show="can('add_vulnerabilities_to_exploit_targets')">
                        <div>

                            <span class="pull-right">
                                <button ng-click="add_vulnerability()" class="btn btn-sm btn-white btn-info">
                                    <i class="ace-icon fa fa-plus"></i>
                                    Add New Vulnerability
                                </button> </span>
                        </div>

                        <div class="space-32"></div>
                        <div style="margin-top: 20px" ng-repeat="vulnerability in added_vulnerabilities | filter:{_destroy: '!1'}" class="row">
                            <div class="col-lg-1 col-md-1"></div>
                            <div class="col-lg-10 col-md-10">
                                <div ng-class="{red: vulnerability.validation_error==true}" class="row">
                                    <div class="col-lg-1 col-md-1 no-padding-right">
                                        <span class="badge badge-danger" style="margin-top: 8px" tooltip="Remove Vulnerability"> <a href="" class="fake-link center white" ng-click="remove_vulnerability(vulnerability)"> <i class="fa fa-remove"></i> </a> </span>
                                    </div>
                                    <vulnerability-form vulnerability="vulnerability" save="false" editform="false"></vulnerability-form>
                                </div>
                            </div>
                            <div class="col-lg-2 col-md-2"></div>
                            <div class="space-12 ciap_margin_060"></div>
                        </div>

                        <div class="space-12"></div>
                        <div>
                            <div class="widget-header widget-header-small ">
                                <h4 class="widget-title blue smaller"><i class="ace-icon fa fa-tasks orange"></i> Attached Vulnerabilities </h4>
                            </div>
                            <div class="space-6"></div>

                            <div class="width-90 center-block" ng-show="exploit_target.vulnerabilities.length && show_browser == false">
                                <div class="ciap_table_scroll_500">
                                    <ol class="dd-list">
                                        <li class="dd-item" ng-repeat="vulnerability in exploit_target.vulnerabilities">
                                            <div class="dd-handle">  
                                                <a ng-if="vulnerability.title" ng-class="{red: vulnerability.validation_error==true}" href="#/vulnerabilities/{{vulnerability.guid}}">{{vulnerability.title | prefixWithPortionMarking: vulnerability.portion_marking}}</a>
                                                <a ng-if="!vulnerability.title" ng-class="{red: vulnerability.validation_error==true}" href="#/vulnerabilities/{{vulnerability.guid}}">{{vulnerability.cve_id | prefixWithPortionMarking: vulnerability.portion_marking:vulnerability.cve_id_c}}</a>

                                                <div class="pull-right action-buttons">
                                                    <a class="red" href="" ng-click="editVulnerability(vulnerability)"> <i class="ace-icon fa fa-pencil bigger-130"></i> </a>
                                                    <a class="red" href="" ng-click="removeVulnerability(vulnerability)"> <i class="ace-icon fa fa-trash-o bigger-130"></i> </a>
                                                </div>
                                            </div>
                                        </li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                        <!-- Add Vulnerability Browser here -->
                        <div ng-hide="exploit_target.vulnerabilities.length">
                            No Vulnerabilities
                        </div>

                        <vulnerability-browser selected-vulnerabilities="exploit_target.vulnerabilities" classification-direction="down"></vulnerability-browser>

                        <div class="space-12"></div>
                    </div>

                    <div class="clearfix form-actions">
                        <span ng-show="is_saving"> <i class="ace-icon fa fa-sun-o fa-spin blue bigger-300 pull-right" ng-show="is_saving"></i> </span>
                        <button ng-disabled="is_saving" class="btn btn-info pull-right ciap_mleft_12" type="button" ng-click="to_coas(exploit_target)">
                            <i class="fa fa-arrow-right"></i>
                            Next
                        </button>
                        <button class="btn btn-warning pull-right ciap_mleft_12" type="button" ng-click="part_one = !part_one; part_two = !part_two" ng-disabled="is_saving">
                            <i class="ace-icon fa fa-arrow-left bigger-110"></i> Back
                        </button>
                        <button class="btn btn-default pull-right" type="button" ng-click="cancel()" ng-disabled="is_saving">
                            <i class="ace-icon fa fa-times bigger-110"></i> Cancel
                        </button>
                    </div>

                </div>
            </div>

            <div class="widget-body" ng-show="!part_one && !part_two">
                <div class="widget-main">

                    <div class="space-12"></div>

                    <div ng-show="can('add_course_of_actions_to_exploit_targets')">
                        <div>
                            <div class="widget-header widget-header-small ">
                                <h4 class="widget-title blue smaller"><i class="ace-icon fa fa-tasks orange"></i> Attached Course Of Actions </h4>
                            </div>
                            <div class="space-6"></div>

                            <div class="width-90 center-block" ng-show="exploit_target.course_of_actions.length && show_browser == false">
                                <div class="ciap_table_scroll_500">
                                    <ol class="dd-list">
                                        <li class="dd-item" ng-repeat="course_of_action in exploit_target.course_of_actions">
                                            <div class="dd-handle">
                                                <a href="#/course_of_actions/{{course_of_action.stix_id}}">{{course_of_action.title | prefixWithPortionMarking: course_of_actions.portion_marking}}</a>
                                                <div class="pull-right action-buttons">
                                                    <a class="red" href="" ng-click="removeCourseOfAction(course_of_action)"> <i class="ace-icon fa fa-trash-o bigger-130"></i> </a>
                                                </div>
                                            </div>
                                        </li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                        <!-- Add COA  Browser here -->
                        <div ng-hide="exploit_target.course_of_actions.length">
                            No Course Of Actions
                        </div>

                        <coa-browser selected-coas="exploit_target.course_of_actions" classification-direction="down"></coa-browser>

                        <div class="space-12"></div>
                    </div>

                    <div class="clearfix form-actions">
                        <span ng-show="is_saving"> <i class="ace-icon fa fa-sun-o fa-spin blue bigger-300 pull-right" ng-show="is_saving"></i> </span>
                        <button ng-disabled="is_saving" class="btn btn-info pull-right ciap_mleft_12" type="button" ng-click="start_save(exploit_target)">
                            <i class="fa fa-check"></i>
                            Save
                        </button>
                        <button class="btn btn-warning pull-right ciap_mleft_12" type="button" ng-click="back_vulnerability(exploit_target)" ng-disabled="is_saving">
                            <i class="ace-icon fa fa-arrow-left bigger-110"></i> Back
                        </button>
                        <button class="btn btn-default pull-right" type="button" ng-click="cancel()" ng-disabled="is_saving">
                            <i class="ace-icon fa fa-times bigger-110"></i> Cancel
                        </button>
                    </div>

                </div>

            </div>
        </div>
    </div>
</form>
