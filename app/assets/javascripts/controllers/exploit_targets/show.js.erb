app.controller('ExploitTargetsShowController', ['$scope','$routeParams','$rootScope','$location','Restangular',
  function ($scope, $routeParams, $rootScope, $location, Restangular) {
    $scope.fetching = true;
    $scope.can = $rootScope.can;
    $scope.showTable = {coa_data: true, collapse: false};

    Restangular.one("/exploit_targets/"+$routeParams.id).get().then(function(data){
      $scope.exploit_target = data;
      $scope.exploit_target.course_of_actions = data.course_of_actions;
      $rootScope.breadcrumbs = [{text:'Home',link:'#/',icon:'fa-home'},
                                {text:'All Exploit Targets',link:'#/exploit_targets',icon:'fa-list'},
                                {text:data.stix_id,link:'#/exploit_targets/'+encodeURIComponent(data.stix_id),icon:'fa-eye'}];
      $scope.fetching = false;
    },function(res){
      toastr.error(res.data.errors[0]);
      $scope.fetching = false;
    });
    $scope.destroy = function(exploit_target){
      var justification = prompt("Justification for deleting exploit target");
      if (justification){
        $scope.fetching = true;
        Restangular.one("/exploit_targets/"+exploit_target.stix_id).remove().then(function(data){
          toastr.success("Exploit Target removed");
          $location.path('/exploit_targets');
          $scope.fetching = false;
        },function(res){
          toastr.error("Could not remove exploit target: "+res.data.errors[0]);
          $scope.fetching = false;
        });
      }
    };
  }
]);
